<!DOCTYPE html>
<html>
<body>

<h2>Train Alert v0.1</h2>

<p id="demo">Loading data...</p>
<p id="location">Loading data...</p>

<script>
var server = "127.0.0.1:8000";
//var server = "https://g48-trainalert.herokuapp.com";

Notification.requestPermission().then(function(result) {
  console.log(result);
});

fetch("/trains")
  .then(response => response.json())
  .then(data => {
           console.log(data);
           document.getElementById("demo").innerHTML = data.data[0].liin;
           data.data.forEach(function(train) {
               console.log(train.liin);
           });
       });

var x = document.getElementById("location");
var longitude = 0;
var latitude = 0;

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  longitude = position.coords.longitude;
  latitude = position.coords.latitude;
  x.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude;
  fetch("/closest_train?lon="+longitude+"&lat="+latitude)
    .then(response => response.json())
    .then(data => {
      console.log(data);
      var text = 'Test!!!';
      var notification = new Notification('Notification', { body: text});
    });
}

getLocation();


</script>

</body>
</html> 

